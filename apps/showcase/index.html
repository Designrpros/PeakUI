<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <base href="/">
    <title>PeakUI Showcase</title>
    <link rel="icon" type="image/x-icon" href="/assets/favicon.ico">
    <script type="importmap">
        {
            "imports": {
                "env": "./assets/env.js"
            }
        }
    </script>
    <style>
        html,
        body {
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden;
            /* Restored to Black */
            background-color: #000000;
        }

        /* Ensure canvas takes full space */
        canvas {
            display: block;
            width: 100%;
            height: 100%;
            visibility: visible !important;
            opacity: 1 !important;
        }
    </style>

    <link data-trunk rel="copy-dir" href="assets" />

    <link data-trunk rel="rust" href="Cargo.toml" data-bin="peak-ui-showcase" data-cargo-features="wasm"
        data-cargo-no-default-features />
</head>

<body>

    <div id="loading"
        style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 16px; background-color: #000000; z-index: 100;">
        <img src="/assets/peak_logo_dark.png" alt="PeakUI Logo" style="height: 48px; width: auto; opacity: 0.8;">
        <div
            style="color: white; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; font-size: 14px; letter-spacing: 0.5px; opacity: 0.6;">
            PEAKUI
        </div>
    </div>

    <!-- Explicit canvas for Iced to target -->
    <canvas id="iced-canvas" style="width: 100%; height: 100%;"></canvas>

    <script>
        // Garbage Collector for WebViews and Images
        // Removes elements that haven't been updated by the Rust layout engine recently
        setInterval(() => {
            const now = Date.now();
            const elements = document.querySelectorAll('iframe[id^="peakui-webview-"], img[id^="peakui-image-"]');

            elements.forEach(el => {
                const lastUpdated = parseFloat(el.getAttribute('data-last-updated') || '0');
                // If not updated in 200ms (missed ~12 frames), remove it
                if (now - lastUpdated > 200) {
                    el.remove();
                }
            });
        }, 100);

        // Hide loading screen once the canvas is ready
        const observer = new MutationObserver((mutations) => {
            const canvas = document.querySelector('canvas');
            if (canvas) {
                // We add a small delay to ensure the first frame is painted
                setTimeout(() => {
                    document.getElementById('loading').style.transition = 'opacity 0.5s ease-out';
                    document.getElementById('loading').style.opacity = '0';
                    setTimeout(() => {
                        document.getElementById('loading').style.display = 'none';
                    }, 500);
                }, 200); // Increased delay slightly
                observer.disconnect();
            }
        });
        observer.observe(document.body, { childList: true, subtree: true });
    </script>
</body>

</html>